<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Organic Synthesis: Preparation Lab v2.0</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <script src="https://unpkg.com/smiles-drawer@2.0.1/dist/smiles-drawer.min.js"></script>

  <style>
    :root { --bg-dark: #0f172a; --bg-panel: #1e293b; --accent: #8b5cf6; }
    body { font-family: 'Space Grotesk', sans-serif; background-color: var(--bg-dark); color: white; }
    .mono { font-family: 'JetBrains Mono', monospace; }
    
    .fade-in { animation: fadeIn 0.4s ease-out forwards; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    
    .loader { border: 2px solid rgba(255,255,255,0.1); border-top: 2px solid #a78bfa; border-radius: 50%; width: 24px; height: 24px; animation: spin 0.8s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    /* REACTION ARROW STYLING */
    .arrow-body { height: 2px; background: #94a3b8; width: 100%; position: relative; min-width: 60px; }
    .arrow-head { position: absolute; right: 0; top: -5px; width: 0; height: 0; border-top: 6px solid transparent; border-bottom: 6px solid transparent; border-left: 10px solid #94a3b8; }
  </style>
</head>
<body class="h-full flex flex-col overflow-hidden">

  <nav class="bg-slate-900/90 backdrop-blur border-b border-slate-800 z-50">
    <div class="max-w-7xl mx-auto px-6 py-4 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-violet-500 to-fuchsia-500 flex items-center justify-center text-2xl shadow-lg shadow-violet-500/20">üèóÔ∏è</div>
        <div>
          <h1 class="font-bold text-lg leading-none">Organic Synthesis Lab <span class="text-xs bg-violet-900 text-violet-300 px-1.5 py-0.5 rounded ml-1">v2.0</span></h1>
          <p class="text-[10px] text-slate-400 font-mono mt-1">STANDARD EQUATION FORMAT</p>
        </div>
      </div>
      <div class="text-xs font-mono text-slate-500 hidden md:block border border-slate-700 px-2 py-1 rounded bg-slate-800">
        Reactant + Reagent ‚Üí Product
      </div>
    </div>
  </nav>

  <main id="root" class="flex-1 overflow-hidden relative"></main>

  <script type="text/babel">
    const { useState, useEffect, useRef, useMemo } = React;

    // --- 1. OPSIN HOOK ---
    const useOpsin = (iupacName) => {
      const [smiles, setSmiles] = useState(null);
      const [loading, setLoading] = useState(false);
      const CACHE = {
        'Ethanol': 'CCO', 'Ethene': 'C=C', 'Propene': 'CC=C', 'Propan-2-ol': 'CC(O)C',
        '2-Bromopropane': 'CC(Br)C', 'Benzene': 'c1ccccc1', 'Nitrobenzene': '[O-][N+](=O)c1ccccc1',
        'Ethanoic Acid': 'CC(=O)O', 'Ethyl Ethanoate': 'CC(=O)OCC', 'Ethanoyl Chloride': 'CC(=O)Cl',
        'Aniline': 'Nc1ccccc1', 'Phenol': 'Oc1ccccc1', 'Benzoic Acid': 'O=C(O)c1ccccc1',
        'Chloromethane': 'ClC', 'Ethane': 'CC', 'Chloroethane': 'ClCC', 'Bromoethane': 'CCBr',
        'Methylbenzene': 'Cc1ccccc1', 'Phenylethanone': 'CC(=O)c1ccccc1', 'Ethanal': 'CC=O',
        'But-2-ene': 'CC=CC', 'Propan-1-ol': 'CCCO', 'Methanal': 'C=O', 'Ethanamide': 'CC(=O)N',
        'Ethanenitrile': 'CC#N', 'Methanamine': 'CN', 'Sodium Ethanoate': 'CC(=O)[O-].[Na+]',
	'Butan-2-ol':'CCC(C)O', '2-Chloro-3-methylbutane':'CC(C)C(C)Cl','2-Methylbut-2-ene':'C/C=C(C)/C', 'Butane':'CCCC', 
	'Glucose':'C([C@@H]1[C@H]([C@@H]([C@H](C(O1)O)O)O)O)O', 'Propanone':'CC(C)=O', 'Propanoic acid':'CCC(=O)O'      
};

      useEffect(() => {
        if (!iupacName) return;
        const fetchSMILES = async () => {
          setLoading(true);
          if (CACHE[iupacName]) { setSmiles(CACHE[iupacName]); setLoading(false); return; }
          try {
            const res = await fetch(`https://opsin.ch.cam.ac.uk/opsin/${iupacName}.json`);
            if (res.ok) { const data = await res.json(); setSmiles(data.smiles); } 
            else setSmiles(null);
          } catch(e) { setSmiles(null); }
          setLoading(false);
        };
        fetchSMILES();
      }, [iupacName]);
      return { smiles, loading };
    };

    // --- 2. CANVAS COMPONENT ---
    const MoleculeCanvas = ({ iupac, label, isProduct = false }) => {
      const { smiles, loading } = useOpsin(iupac);
      const canvasRef = useRef(null);

      useEffect(() => {
        if (smiles && window.SmilesDrawer && canvasRef.current) {
          const drawer = new window.SmilesDrawer.Drawer({ 
            width: 200, height: 140, bondThickness: 1.2, backgroundColor: 'transparent', drawingType: 'dark' 
          });
          window.SmilesDrawer.parse(smiles, (tree) => drawer.draw(tree, canvasRef.current, 'light', false));
        }
      }, [smiles]);

      return (
        <div className={`flex flex-col items-center justify-center p-4 rounded-2xl border w-full h-full relative group transition-all duration-300 ${isProduct ? 'bg-violet-900/10 border-violet-500/30' : 'bg-slate-800/50 border-slate-700'}`}>
          <span className={`absolute top-2 left-3 text-[10px] font-bold tracking-widest uppercase ${isProduct ? 'text-violet-400' : 'text-slate-500'}`}>{label}</span>
          {loading && <div className="loader"></div>}
          {!loading && smiles && <canvas ref={canvasRef} width="200" height="140" className="w-full h-40 object-contain filter invert opacity-90 group-hover:opacity-100 transition-opacity"></canvas>}
          {!loading && !smiles && <div className="text-slate-600 text-xs">Structure N/A</div>}
          <div className={`mt-1 px-3 py-1 rounded-full text-xs font-mono border ${isProduct ? 'bg-violet-500/20 text-violet-200 border-violet-500/30' : 'bg-slate-700/50 text-slate-300 border-slate-600'}`}>{iupac}</div>
        </div>
      );
    };

    // --- 3. REFACTORED DATABASE (Complete Equation Fields) ---
    const PREPARATION_DB = [
      {
        id: 'alkenes', targetClass: 'Alkenes',
        methods: [
          { 
            id: 'dehydration', name: 'Dehydration of Alcohols', 
            start: 'Ethanol', target: 'Ethene', 
            agent: 'Conc. H‚ÇÇSO‚ÇÑ', cat: '', cond: 'heat', side: '+ H‚ÇÇO',
            desc: 'Elimination of water. Acid acts as dehydrating agent.'
          },
	{ 
            id: 'dehydration_but', name: 'Dehydration of butan-2-ol', 
            start: 'Butan-2-ol', target: 'But-2-ene', 
            agent: 'Conc. H‚ÇÇSO‚ÇÑ', cat: '', cond: 'heat', side: '+ H‚ÇÇO',
            desc: 'Elimination of water. But-2-ene is a major product.'
          },
          { 
            id: 'dehydrohal', name: 'Dehydrohalogenation', 
            start: '2-Bromopropane', target: 'Propene', 
            agent: 'KOH', cat: 'Ethanol', cond: 'Reflux', side: '+ KBr + H‚ÇÇO',
            desc: 'Elimination of HX using KOH, Ethanol, reflux..'
          },
	{ 
            id: 'dehydrohal_but', name: 'Dehydrohalogenation of 2-chloro-3-methylbutane', 
            start: '2-Chloro-3-methylbutane', target: '2-Methylbut-2-ene', 
            agent: 'KOH', cat: 'Ethanol', cond: 'Reflux', side: '+ KBr + H‚ÇÇO',
            desc: 'Elimination of HX using ethanolic KOH. 2-Methylbut-2-ene is a major product.'
          }
        ]
      },
      {
        id: 'alkanes', targetClass: 'Alkanes',
        methods: [
          { 
            id: 'hydrog', name: 'Hydrogenation of Alkenes', 
            start: 'Ethene', target: 'Ethane', 
            agent: 'H‚ÇÇ', cat: 'Pt', cond: '180¬∞C', side: '',
            desc: 'Catalytic addition of hydrogen to double bond.'
          },
	{ 
            id: 'hydrog_but', name: 'Hydrogenation of But-2-ene', 
            start: 'But-2-ene', target: 'Butane', 
            agent: 'H‚ÇÇ', cat: 'Pt', cond: '180¬∞C', side: '',
            desc: 'Catalytic addition of hydrogen to double bond.'
          }
        ]
      },
      
      {
        id: 'alcohols', targetClass: 'Alcohols',
        methods: [
          {
            id: 'hydration', name: 'Hydration of Alkenes',
            start: 'Ethene', target: 'Ethanol',
            agent: 'H‚ÇÇO', cat: 'H‚ÇÉPO‚ÇÑ', cond: '300¬∞C', side: '',
            desc: 'Industrial preparation (Steam hydration).'
          },
          {
            id: 'hydrolysis', name: 'Hydrolysis of Haloalkanes',
            start: 'Chloroethane', target: 'Ethanol',
            agent: 'NaOH (aq)', cat: '-', cond: 'Reflux', side: '+ NaCl',
            desc: 'Nucleophilic substitution.'
          },
          {
            id: 'fermentation', name: 'Fermentation of Glucose',
            start: 'Glucose', target: 'Ethanol',
            agent: '', cat: 'zymase', cond: '', side: 'CO‚ÇÇ',
            desc: 'Fermentation of glucose breaks down glucose into ethanol and CO‚ÇÇ through anaerobic respiration of yeast.'
          }
        ]
      },
      {
        id: 'carbonyls', targetClass: 'Carbonyls',
        methods: [
          {
            id: 'ox_primary', name: 'Oxidation of 1¬∞ Alcohol',
            start: 'Ethanol', target: 'Ethanal',
            agent: 'PCC', cat: 'CH‚ÇÇCl‚ÇÇ', cond: '', side: '',
            desc: 'Mild oxidation stops at Aldehyde.'
          },
          {
            id: 'strong_ox_sec', name: 'Oxidation of 2¬∞ Alcohol (Strong)',
            start: 'Propan-2-ol', target: 'Propanone',
            agent: 'KMnO‚ÇÑ', cat: 'H‚Å∫', cond: 'heat', side: '',
            desc: 'Strong oxidation of 2¬∞ Alcohol would produce a ketone.'
          },
	{
            id: 'mild_ox_sec', name: 'Oxidation of 2¬∞ Alcohol (Mild)',
            start: 'Propan-2-ol', target: 'Propanone',
            agent: 'PCC', cat: 'CH‚ÇÇCl‚ÇÇ', cond: '', side: '',
            desc: 'Mild oxidation of 2¬∞ Alcohol would produce a ketone.'
          }
        ]
      },
      {
        id: 'carboxylic', targetClass: 'Carboxylic Acids',
        methods: [
          {
            id: 'ox_strong', name: 'Oxidation of 1¬∞ Alcohol',
            start: 'Propan-1-ol', target: 'Propanoic acid',
            agent: 'KMnO‚ÇÑ', cat: 'H‚Å∫', cond: 'Reflux', side: '+ H‚ÇÇO',
            desc: 'Strong oxidation of 1¬∞ Alcohol would continue into aldehyde and then carboxylic acid.'
          },
	{
            id: 'ox_ald', name: 'Oxidation of Aldehydes',
            start: 'Propanal', target: 'Propanoic acid',
            agent: 'KMnO‚ÇÑ', cat: 'H‚Å∫', cond: 'Reflux', side: '+ H‚ÇÇO',
            desc: 'Strong oxidation of aldehyde would produce carboxylic acid.'
          }
        
        ]
      }
    ];

    // --- 4. MAIN COMPONENT ---
    const SynthesisLab = () => {
      const [targetClassIdx, setTargetClassIdx] = useState(0);
      const [methodIdx, setMethodIdx] = useState(0);

      const currentClass = PREPARATION_DB[targetClassIdx];
      const currentMethod = currentClass.methods[methodIdx];

      const handleClassChange = (e) => {
        setTargetClassIdx(parseInt(e.target.value));
        setMethodIdx(0);
      };

      return (
        <div className="flex flex-col h-full bg-slate-950">
          
          {/* CONTROL PANEL */}
          <div className="p-6 bg-slate-900 border-b border-slate-800 flex flex-col md:flex-row gap-6 items-end shadow-xl z-10">
            <div className="w-full md:w-1/3">
              <label className="block text-xs font-bold text-violet-400 uppercase mb-2 tracking-wider">Target Family:</label>
              <div className="relative group">
                <select 
                  value={targetClassIdx} 
                  onChange={handleClassChange}
                  className="w-full p-4 bg-slate-800 border border-slate-700 rounded-xl font-bold text-lg text-white appearance-none focus:ring-2 focus:ring-violet-500 focus:border-transparent cursor-pointer hover:bg-slate-700/80 transition-colors"
                >
                  {PREPARATION_DB.map((cls, idx) => (
                    <option key={cls.id} value={idx}>{cls.targetClass}</option>
                  ))}
                </select>
                <div className="absolute right-4 top-5 pointer-events-none text-violet-400">‚ñº</div>
              </div>
            </div>

            <div className="w-full md:w-2/3">
              <label className="block text-xs font-bold text-slate-400 uppercase mb-2 tracking-wider">Preparation Method:</label>
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2">
                {currentClass.methods.map((m, idx) => (
                  <button 
                    key={m.id}
                    onClick={() => setMethodIdx(idx)}
                    className={`p-3 rounded-lg text-sm text-left font-medium transition-all border ${
                      methodIdx === idx 
                      ? 'bg-violet-600 text-white border-violet-500 shadow-md transform scale-[1.02]' 
                      : 'bg-slate-800 text-slate-400 border-slate-700 hover:border-slate-500 hover:text-white'
                    }`}
                  >
                    {m.name}
                  </button>
                ))}
              </div>
            </div>
          </div>

          {/* SIMULATION CHAMBER */}
          <div className="flex-1 overflow-y-auto p-4 md:p-8 relative">
             <div className="absolute inset-0 opacity-5 pointer-events-none" style={{backgroundImage: 'radial-gradient(#94a3b8 1px, transparent 1px)', backgroundSize: '24px 24px'}}></div>
             
             <div className="max-w-7xl mx-auto flex flex-col gap-6">
               
               {/* EQUATION ROW */}
               <div className="flex flex-col xl:flex-row items-center justify-center gap-4 relative z-10 min-h-[320px]">
                  
                  {/* 1. STARTING MATERIAL */}
                  <div className="w-full xl:w-[280px] h-60 fade-in" style={{animationDelay: '0ms'}}>
                    <MoleculeCanvas iupac={currentMethod.start} label="Starting Material" />
                  </div>

                  {/* PLUS */}
                  <div className="text-slate-600 text-3xl font-light hidden xl:block">+</div>

                  {/* 2. REAGENT BLOCK (Inorganic Reactant) */}
                  <div className="w-32 h-32 flex flex-col items-center justify-center bg-slate-800/80 rounded-xl border-2 border-dashed border-slate-600 shrink-0 shadow-sm fade-in" style={{animationDelay: '50ms'}}>
                     <span className="text-[10px] font-bold text-slate-400 uppercase mb-1">Add</span>
                     <div className="text-lg font-mono font-bold text-blue-400 text-center leading-tight px-1">
                        {currentMethod.agent !== '-' ? currentMethod.agent : <span className="text-slate-600 italic">No addn</span>}
                     </div>
                  </div>

                  {/* 3. ARROW BLOCK (Catalyst/Cond) */}
                  <div className="flex flex-col items-center justify-center w-40 shrink-0 mx-2 fade-in" style={{animationDelay: '100ms'}}>
                    <div className="text-xs font-bold text-amber-500 mb-1 text-center min-h-[20px]">{currentMethod.cat !== '-' ? currentMethod.cat : ''}</div>
                    <div className="arrow-body"><div className="arrow-head"></div></div>
                    <div className="text-[10px] font-mono text-slate-500 mt-2 bg-slate-900 px-2 py-0.5 rounded border border-slate-800">{currentMethod.cond}</div>
                  </div>

                  {/* 4. TARGET PRODUCT */}
                  <div className="w-full xl:w-[280px] h-60 relative fade-in" style={{animationDelay: '200ms'}}>
                    <MoleculeCanvas iupac={currentMethod.target} label="Target Product" isProduct={true} />
                    
                    {/* SIDE PRODUCT TAG */}
                    {currentMethod.side && (
                       <div className="absolute -bottom-8 right-0 bg-slate-800 text-slate-400 text-xs px-3 py-1.5 rounded-lg border border-slate-700 font-mono flex items-center gap-2">
                          <span className="text-slate-600 font-bold">Side Products:</span> {currentMethod.side}
                       </div>
                    )}
                  </div>
               </div>

               {/* THEORY CARD */}
               <div className="bg-slate-900/80 border border-slate-800 rounded-2xl p-6 md:p-8 backdrop-blur-sm w-full shadow-2xl fade-in mt-4" style={{animationDelay: '300ms'}}>
                 <div className="flex items-start gap-4">
                   <div className="text-3xl">üí°</div>
                   <div className="flex-1">
                     <h3 className="text-violet-400 font-bold uppercase text-sm tracking-widest mb-1">Mechanism Insight</h3>
                     <h4 className="text-xl font-bold text-white mb-2">{currentMethod.name}</h4>
                     <p className="text-slate-300 leading-relaxed text-base">{currentMethod.desc}</p>
                   </div>
                 </div>
               </div>

             </div>
          </div>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<SynthesisLab />);
  </script>
</body>
</html>
